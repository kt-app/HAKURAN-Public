# 博覧会のwebアプリ
publicやsrc内のファイルは本番環境と異なる部分が多くあります。
初のnode.js製のアプリケーションなので、拙いところが多いです...
## バックエンドの仕様
このアプリケーションはexpressをフレームワークとして使用しています。
クライアントがこのアプリケーションにgetリクエストを送ると、JWTトークンがあるかをミドルウェアにて判断して、
トークンが確認された場合のみにビルドしたReactで作られたファイルをレスポンスするようにしています。
リクエストにJWTトークンが存在しない場合、サーバーはlogin.htmlをレスポンスします。
### 認証の仕組み（パスワード）
login.htmlによってユーザーがpasswordをpostすると、環境変数に設定したパスワードと照合し、cookieにJWTトークンを付与して、confirm.htmlを送信します。
### 認証の仕組み（googleアカウント）
もともと、oauth2.0を使用したfirebase等で学校のアカウントを判別しようとしていましたが、学校アカウントだと、このような見知らぬアプリケーションへの認証を防ぐようで、実装できませんでした。
代わりに学校内の人のみが実行できるGASを作成し、そのGASにエンドポイントを設定することで認証システムの実装を実現しました。
login.htmlでユーザーが認証ボタンを押すと、GASのエンドポイントへアクセスします。
GASでは、socket通信に使われるidをクエリとして受け取り、idを暗号化して、"/authentication"に送信します。
サーバでは受け取った暗号化されたidを解読して、そのidあてにsocket.ioを用いてWS通信でアクセスすべきurlをクライアント(login.html)に送信します。
そして、クライアント側のjavascriptで受け取ったurlにアクセスをし、サーバで改めてクエリが正しい場合にcookieにJWTトークンを付与して、confirm.htmlを送信します。
DB的なのを使うのが嫌だったのでこのような仕様になってしまいました。
がばがば認証...(漏らされなければセーフ)
## フロントエンドの仕様
認証されたユーザーに送信するファイルはモダンかつサーバー負荷軽減を考え、デプロイ時にReactのコンポーネントをビルドして静的ファイルとして保存したものを送信しています。

